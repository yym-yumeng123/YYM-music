<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>FM</title>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="./css/index.css">
	<script src="//at.alicdn.com/t/font_434295_dxha178jwggv6lxr.js"></script>
	<style>

	</style>
</head>
<body>
	<div class="pages">
		<!-- <div class="bg"></div> -->
		<img id="bg" src="" alt=""> <!-- images/bg.jpg -->
		<div class="play clearfix">
			<!-- 左边专辑播放页 -->
			<div class="music-panel">
				<img src="" alt="专辑封面">
				<div class="pic">
					<svg class="icon iconfont">
				    	<use xlink:href="#icon-dianzan"></use>
					</svg>
					<svg class="icon iconfont zanting">
					    <use xlink:href="#icon-zanting"></use>
					</svg>
					<svg class="icon iconfont bofang">
					    <use xlink:href="#icon-bofang"></use>
					</svg>
					<svg class="icon iconfont ttpodicon">
					    <use xlink:href="#icon-ttpodicon"></use>
					</svg>
				</div>			
			</div>

			<!-- 右边歌曲信息 -->
			<div class="intro">
				<p>在路上</p>
				<h2>It's a new day</h2>
				<div class="information">
					<svg class="icon icon-num">
				    	<use xlink:href="#icon-1"></use>
					</svg>100
				</div>
				<div class="information">
					<svg class="icon icon-num">
					    <use xlink:href="#icon-dianzan"></use>
					</svg>300
				</div>
				<div class="information">
					<svg class="icon icon-num">
					    <use xlink:href="#icon-d"></use>
					</svg>LavaRadio
				</div>

				<div class="progress">
			        <div class="bar">
			          <div class="progress-total"></div>
			          <div class="progress-now"></div>
			        </div>
			        <div class="time">0:00</div>
			        <div class="info">
			        	<div class="title"></div>
			        	<div class="auther"></div>
			    	</div>
			     </div>   

			</div>
		</div>

		<ul class="clearfix">
			<p class="left"><</p>
			<li>
				<img src="images/1.jpg" data-channal="public_aaa_bbb" alt="专题">
				<div class="name">
					
				</div>				
			</li>
			<li>
				<img src="images/2.jpg" alt="专题">
				<div class="name">					
				</div>					
			</li>
			<li>
				<img src="images/3.jpg" alt="专题">	
				<div class="name">					
				</div>				
			</li>
			<li>
				<img src="images/4.jpg" alt="专题">	
				<div class="name">					
				</div>				
			</li>
			<li>
				<img src="images/5.jpg" alt="专题">
				<div class="name">					
				</div>	
			</li>
			<li>
				<img src="images/6.jpg" alt="专题">
				<div class="name">					
				</div>	
			</li>
			<p class="right">></p>
		</ul>

	</div>


<script>


	var Singlename = document.querySelectorAll("ul>li .name")
	//获取专辑分类
	var xhr = new XMLHttpRequest()
	xhr.open('GET',' https://jirenguapi.applinzi.com/fm/getChannels.php',true)
	xhr.onload = function(){
		if ((xhr.status>=200 && xhr.status<300) || xhr.status == 300) {
			var list = JSON.parse(xhr.responseText)
			console.log(list)
			var index = 0
			for (var i = 0; i < Singlename.length; i++) {
				Singlename[i].innerText = list.channels[index].name
				index++
			}								 
		}else{
			alert("服务器异常")
		}
	}
	xhr.send()



	//声明变量存储元素
	var currentIndex = 0
	var clock
	var musiclist = []
	var audioObject = new Audio()
	audioObject.autoplay = true
	var title = document.querySelector('.info .title')
	var auther = document.querySelector('.info .auther')
	var pic = document.querySelector('.music-panel img')
	var bg = document.querySelector('#bg')
	var progressNow = document.querySelector('.progress .progress-now')
	var time = document.querySelector('.progress .time')
	var pau = document.querySelector('.zanting')
	var playS = document.querySelector('.bofang')
	var ttpodicon = document.querySelector('.ttpodicon')
	var bar = document.querySelector('.progress .bar')

	//音乐地址
	//封装一个函数
	
	function getMusiclist(callback){

		var xhr = new XMLHttpRequest()
		xhr.open('GET','https://jirenguapi.applinzi.com/fm/getSong.php?',true)
		xhr.onload = function(){
			if ((xhr.status>=200 && xhr.status<300) || xhr.status == 300) {
				var data = JSON.parse(xhr.responseText)		
				callback(data)
			}else{
				alert("服务器异常")
			}
		}
		xhr.send()
	}
	getMusiclist(callback)


	//调用
	 function callback(data) {
		musicObj = data.song[0]
		 console.log(musicObj)
		 loadMusic(musicObj)
	}
	
	// getMusiclist(function(list){
	// 	musiclist = list.song[0]
	// 	// 获取音乐播放列表第一个
	// 	loadMusic(list.song[0])  //currentIndex
	// 	console.log(musiclist)
	// })
	
	function loadMusic(musicObj){
		console.log(musicObj)
		//获取资源的url,标题和作者
		audioObject.src =  musicObj.url 
		title.innerText = musicObj.title
		auther.innerText = musicObj.artist
		pic.src = musicObj.picture
		bg.src = musicObj.picture
	}

	audioObject.ontimeupdate = function(){
		//进度条的百分比
		progressNow.style.width = this.currentTime/this.duration *100 + '%'
	}

	//播放时时间设置
	audioObject.onplay = function(){
		clock = setInterval(function(){
			var min = Math.floor(audioObject.currentTime/60)
			var sec = Math.floor(audioObject.currentTime%60) + ''
			sec = sec.length == 2 ? sec : "0" + sec
			time.innerText = min + ':' + sec
		},1000)
	}
	audioObject.onpause = function(){
		clearInterval(clock)
	}
	audioObject.onended = function(){
		getMusiclist(callback)
		//loadMusic()  //加载音乐函数
		// currentIndex = (++currentIndex)%musiclist.length
	}
	//点击暂停
	pau.onclick = function(){
		audioObject.pause()
	}
	//点击播放
	playS.onclick = function(){
		audioObject.play()
	}
	//下一曲
	ttpodicon.onclick = function(){

		getMusiclist(callback)
		//currentIndex = (++currentIndex)%musiclist.length
		console.log(currentIndex)
	}

	bar.addEventListener('click',function(e){
		console.log(e)
		var percent = e.offsetX / parseInt(getComputedStyle(this).width)
		audioObject.currentTime = audioObject.duration * percent

	})


	//'http://cloud.hunger-valley.com/music/玫瑰.mp3'
</script>

 

</body>
</html>